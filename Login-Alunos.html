<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Biblioteca - Escola Máximu's</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@400;700&display=swap" rel="stylesheet">
  
  <!-- Firebase compat (para login) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <!-- Firebase modular (para livros) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-app.js";
    import { getDatabase, ref, onChildAdded } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-database.js";


    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    const listaLivrosEl = document.getElementById("listaLivros");
    const livrosBanco = [];

    function criarCardLivro(titulo, autor, imagem) {
      const card = document.createElement("div");
      card.className = "card";

      const img = document.createElement("img");
      img.alt = "Capa do livro";
      const placeholder = "https://via.placeholder.com/100x150?text=Sem+Imagem";
      img.src = (imagem && imagem.startsWith("http")) ? imagem : placeholder;

      const tituloEl = document.createElement("p");
      tituloEl.className = "titulo";
      tituloEl.textContent = titulo;

      const autorEl = document.createElement("p");
      autorEl.className = "autor";
      autorEl.textContent = autor;

      const btnDetalhes = document.createElement("button");
      btnDetalhes.className = "btn-detalhes";
      btnDetalhes.textContent = "Detalhes";
      btnDetalhes.onclick = () => alert(`Título: ${titulo}\nAutor: ${autor}`);

      card.appendChild(img);
      card.appendChild(tituloEl);
      card.appendChild(autorEl);
      card.appendChild(btnDetalhes);

      listaLivrosEl.appendChild(card);
    }

    function atualizarListaLivros() {
      listaLivrosEl.innerHTML = "";
      livrosBanco.forEach(livro => criarCardLivro(livro.titulo, livro.autor, livro.imagem || ""));
    }

    document.getElementById("btnPesquisar").addEventListener("click", function () {
      const termoBusca = document.getElementById("pesquisa").value.toLowerCase().trim();
      listaLivrosEl.innerHTML = "";

      const resultados = livrosBanco.filter(livro =>
        livro.titulo.toLowerCase().includes(termoBusca) ||
        livro.autor.toLowerCase().includes(termoBusca)
      );

      if (resultados.length === 0) {
        listaLivrosEl.innerHTML = "<p style='text-align:center;'>Nenhum livro encontrado.</p>";
      } else {
        resultados.forEach(livro => criarCardLivro(livro.titulo, livro.autor, livro.imagem || ""));
      }
    });

    onChildAdded(ref(database, "livros"), (snapshot) => {
      const livro = snapshot.val();
      livro.id = snapshot.key;
      livrosBanco.push(livro);
      atualizarListaLivros();
    });
  </script>

 <style>
  body {
    font-family: "Josefin Sans", sans-serif;
    margin: 0;
    background: #f0f2f5;
    color: #333;
  }

  .tela {
    display: none;
    width: 100vw;
    height: 100vh;
  }

  .tela.ativa {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
  }

  /* ---- LOGIN ---- */
  #telaLogin {
    background: linear-gradient(135deg, #627df7, #4a5fc1);
  }

  .container {
    background: #fff;
    padding: 40px 30px;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    width: 320px;
    text-align: center;
  }

  .container h2 {
    margin-bottom: 20px;
    color: #333;
  }

  input {
    font-family: "Josefin Sans", sans-serif;
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 15px;
    transition: all 0.2s;
  }

  input:focus {
    border-color: #627df7;
    outline: none;
    box-shadow: 0 0 4px rgba(98,125,247,0.4);
  }

  button {
    font-family: "Josefin Sans", sans-serif;
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 6px;
    border: none;
    font-size: 16px;
    cursor: pointer;
    background: #627df7;
    color: white;
    transition: background 0.3s;
  }

  button:hover {
    background: #4a5fc1;
  }

  .msg {
    margin-top: 12px;
    font-weight: bold;
    font-size: 14px;
  }
  .error { color: #d9534f; }
  .success { color: #28a745; }

  /* ---- LIVROS ---- */
  #telaLivros {
    flex-direction: column;
    align-items: stretch;
  }

  .top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #627df7;
    padding: 12px 20px;
    color: white;
  }

  .top-bar input {
    width: 220px;
    padding: 8px;
    border-radius: 6px;
    border: none;
    font-size: 14px;
  }

  .top-bar button {
    width: auto;
    padding: 8px 14px;
    margin-left: 8px;
    background: #db6d05;
    border-radius: 6px;
    transition: background 0.3s;
  }

  .top-bar button:hover {
    background: #b45703;
  }

  .grid-livros {
    flex: 1;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    padding: 20px;
    background: #f9f9f9;
    overflow-y: auto;
  }

  .card {
    border: 1px solid #ddd;
    border-radius: 10px;
    padding: 12px;
    margin: 12px;
    text-align: center;
    width: 160px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    background: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transition: transform 0.2s;
  }

  .card:hover {
    transform: translateY(-4px);
  }

  .card img {
    width: 100px;
    height: 140px;
    object-fit: cover;
    border-radius: 4px;
  }

  .titulo {
    font-weight: bold;
    font-size: 1rem;
    margin: 0;
    color: #333;
  }

  .autor {
    font-style: italic;
    font-size: 0.9rem;
    margin: 0;
    color: #777;
  }

  .btn-detalhes {
    padding: 6px 10px;
    font-size: 0.85rem;
    cursor: pointer;
    border: none;
    border-radius: 6px;
    width: 100%;
    background-color: #627df7;
    color: white;
    transition: background 0.3s;
  }

  .btn-detalhes:hover {
    background-color: #4a5fc1;
  }
</style>

</head>
<body>
  <!-- Tela de Login -->
  <div id="telaLogin" class="tela ativa">
    <div class="container">
      <h2>Login Aluno</h2>
      <input type="text" id="nome" placeholder="Nome Completo" />
      <input type="text" id="matricula" placeholder="Matrícula" />
      <button onclick="loginAluno()">Entrar</button>
      <div id="msg" class="msg"></div>
    </div>
  </div>

  <!-- Tela de Livros -->
  <div id="telaLivros" class="tela">
    <div class="top-bar">
      <div>
        <input type="text" id="pesquisa" placeholder="Pesquisar autor ou livro" />
        <button id="btnPesquisar">Pesquisar</button>
      </div>
      <button onclick="logout()">Sair</button>
    </div>
    <div class="grid-livros" id="listaLivros"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB5lw6roQDGx43Fd1_uIxZjVyHtnVonZ2Y",
      authDomain: "biblioteca-73fcc.firebaseapp.com",
      projectId: "biblioteca-73fcc",
      storageBucket: "biblioteca-73fcc.appspot.com",
      messagingSenderId: "1015670120228",
      appId: "1:1015670120228:web:d6d1d827871e63881f1db1"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function mostrarTela(id) {
      document.querySelectorAll(".tela").forEach(t => t.classList.remove("ativa"));
      document.getElementById(id).classList.add("ativa");
    }

    function loginAluno() {
      const nome = document.getElementById("nome").value.trim().toLowerCase();
      const matricula = document.getElementById("matricula").value.trim();
      const msg = document.getElementById("msg");

      if (!nome || !matricula) {
        msg.textContent = "Preencha todos os campos.";
        msg.className = "msg error";
        return;
      }

      db.collection("Alunos")
        .where("nome", "==", nome)
        .where("matricula", "==", matricula)
        .get()
        .then((querySnapshot) => {
          if (querySnapshot.empty) {
            msg.textContent = "Nome ou matrícula inválidos.";
            msg.className = "msg error";
          } else {
            msg.textContent = "Login efetuado!";
            msg.className = "msg success";
            setTimeout(() => {
              mostrarTela("telaLivros");
            }, 800);
          }
        })
        .catch((error) => {
          msg.textContent = "Erro: " + error.message;
          msg.className = "msg error";
        });
    }

    function logout() {
      mostrarTela("telaLogin");
    }
  </script>
</body>
</html>
